From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Marcelo Ricardo Leitner <marcelo.leitner@gmail.com>
Date: Thu, 2 May 2019 09:15:15 -0300
Subject: [PATCH] travis: add tests for building using a build dir

In the light of Issue #30.

Signed-off-by: Marcelo Ricardo Leitner <marcelo.leitner@gmail.com>
---
 .travis/linux-build.sh | 18 +++++++++++++++++-
 1 file changed, 17 insertions(+), 1 deletion(-)

diff --git a/.travis/linux-build.sh b/.travis/linux-build.sh
index 04e28bb..797ec2e 100755
--- a/.travis/linux-build.sh
+++ b/.travis/linux-build.sh
@@ -55,6 +55,8 @@ function download_prep_kernel()
 
 function build_lksctp()
 {
+	local use_builddir="$1"
+
 	make distclean || :
 	./bootstrap
 
@@ -63,11 +65,23 @@ function build_lksctp()
 		CFLAGS="$CFLAGS -I$KERNEL_HEADERS"
 	fi
 	export CFLAGS
-	./configure
+
+	if [ "$use_builddir" == 1 ]; then
+		mkdir build
+		pushd build
+		../configure
+	else
+		./configure
+	fi
 
 	make -j $nproc
 
 	make -j $nproc distcheck
+
+	if [ "$use_builddir" == 1 ]; then
+		popd
+		rm -rf build
+	fi
 }
 
 trap cleanup EXIT
@@ -77,9 +91,11 @@ if [ -z "$KERNEL" ]; then
 	for ver in $VERS; do
 		git_prep_kernel "$ver"
 		build_lksctp
+		build_lksctp 1
 	done
 else
 	download_kernel "$KERNEL"
 	download_prep_kernel "$KERNEL"
 	build_lksctp
+	build_lksctp 1
 fi
